<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:b="http://bootsfaces.net/ui"
      xmlns:f="jakarta.faces.core"
      xmlns:h="jakarta.faces.html">

    <body>
        <ui:composition template="./plantilla.xhtml">

            <ui:define name="tituloWeb">Panel de Control</ui:define>

            <ui:define name="contenido">

                <b:carousel id="tiovivo" style="width:100%; margin-bottom: 20px;" interval="3000">
                    <b:carouselItem>
                        <img src="https://placehold.co/1200x300/2c3e50/ffffff?text=Cementerio+La+Paz+-+Tranquilidad+Eterna" 
                             alt="Paisaje 1" style="width: 100%; height: 300px; object-fit: cover;" />
                        <b:carouselCaption>
                            <h3>Sistema de Gestión Integral</h3>
                            <p>Administración eficiente de registros y espacios.</p>
                        </b:carouselCaption>
                    </b:carouselItem>
                    <b:carouselItem>
                        <img src="https://placehold.co/1200x300/27ae60/ffffff?text=Amplias+Areas+Verdes+y+Mantenimiento" 
                             alt="Paisaje 2" style="width: 100%; height: 300px; object-fit: cover;" />
                    </b:carouselItem>
                </b:carousel>

                <b:row>
                    <b:column col-md="3" col-sm="6">
                        <b:panel look="primary" collapsible="false">
                            <f:facet name="heading"><i class="fa fa-users"/> Difuntos</f:facet>
                            <h1 style="text-align: center; margin: 0;">#{difuntoBean.listaDifuntos.size()}</h1>
                            <p class="text-center text-muted">Registrados</p>
                        </b:panel>
                    </b:column>

                    <b:column col-md="3" col-sm="6">
                        <b:panel look="success" collapsible="false">
                            <f:facet name="heading"><i class="fa fa-check"/> Disponibles</f:facet>
                            <h1 style="text-align: center; margin: 0;">#{difuntoBean.listaEspaciosDisponibles.size()}</h1>
                            <p class="text-center text-muted">Nichos/Tumbas</p>
                        </b:panel>
                    </b:column>

                    <b:column col-md="3" col-sm="6">
                        <b:panel look="warning" collapsible="false">
                            <f:facet name="heading"><i class="fa fa-clock-o"/> Programados Hoy</f:facet>
                            <h1 style="text-align: center; margin: 0;">2</h1> 
                            <p class="text-center text-muted">Entierros pendientes</p>
                        </b:panel>
                    </b:column>

                    <b:column col-md="3" col-sm="6">
                        <b:panel look="danger" collapsible="false">
                            <f:facet name="heading"><i class="fa fa-tools"/> Mantenimiento</f:facet>
                            <h1 style="text-align: center; margin: 0;">5</h1>
                            <p class="text-center text-muted">Espacios en revisión</p>
                        </b:panel>
                    </b:column>
                </b:row>

                <hr/>

                <b:row>
                    <b:column col-md="4">
                        <b:panel title="Acciones Rápidas" look="info" collapsible="false">
                            <h:form>
                                <div style="display: grid; gap: 10px;">
                                    <b:commandButton value="Nuevo Registro" look="primary" size="lg" icon="plus"
                                                     onclick="$('.modalPseudoClass').modal(); return false;" 
                                                     style="width: 100%"/>
                                    
                                    <b:button value="Ver Mapa de Sectores" look="default" icon="map-marker" 
                                              href="mapas.xhtml" style="width: 100%"/>
                                              
                                    <b:button value="Reporte Mensual" look="default" icon="file-pdf-o" href="#" style="width: 100%"/>
                                </div>
                            </h:form>
                        </b:panel>

                        <b:panel title="Avisos del Sistema" look="warning" collapsible="true">
                            <b:listLinks>
                                <b:navLink header="Mantenimiento" />
                                <b:navLink value="Sector A cerrado por limpieza" icon="exclamation-triangle" />
                                <b:navLink header="Recordatorios" />
                                <b:navLink value="Revisar pagos pendientes" icon="money" />
                                <b:navLink value="Actualizar inventario" icon="refresh" />
                            </b:listLinks>
                        </b:panel>
                    </b:column>

                    <b:column col-md="8">
                        <b:panel title="Últimos Registros" look="primary" collapsible="false">
                            <h:form id="tablaDifuntos">
                                <b:dataTable value="#{difuntoBean.listaDifuntos}" var="difunto" 
                                             excel="true" pdf="true" print="true" responsive="true"
                                             page-length="5" searching="true">
                                    
                                    <b:dataTableColumn value="#{difunto.nombre}" label="Nombre"/>
                                    
                                    <b:dataTableColumn label="Fecha Def.">
                                        <h:outputText value="#{difunto.fechaDefuncion}" />
                                    </b:dataTableColumn>
                                    
                                    <b:dataTableColumn label="Ubicación">
                                        <b:label text="#{difunto.espacio.codigo}" severity="info" rendered="#{difunto.espacio != null}"/>
                                        <h:outputText value="--" rendered="#{difunto.espacio == null}" />
                                    </b:dataTableColumn>

                                    <b:dataTableColumn label="Acción" orderable="false" style="text-align:center;">
                                        <b:commandButton look="info" icon="eye-open" size="xs" tooltip="Ver"
                                                         action="#{difuntoBean.prepararVista(difunto.id, 'detalle')}" />
                                        
                                        <b:commandButton look="warning" icon="edit" size="xs" tooltip="Editar"
                                                         action="#{difuntoBean.prepararVista(difunto.id, 'modificar')}" 
                                                         style="margin-left: 5px"/>
                                                         
                                        <b:commandButton look="danger" icon="trash" size="xs" tooltip="Borrar"
                                                         action="#{difuntoBean.eliminarDifunto(difunto.id)}" 
                                                         onclick="return confirm('¿Eliminar?');" 
                                                         update="@form :formRegistro:msg" style="margin-left: 5px"/> 
                                    </b:dataTableColumn>
                                </b:dataTable>
                            </h:form>
                        </b:panel>
                        
                        <b:accordion expanded-panels="panel1">
                            <b:panel id="panel1" title="Horarios de Atención">
                                <strong>Lunes a Viernes:</strong> 08:00 AM - 06:00 PM <br/>
                                <strong>Sábados y Domingos:</strong> 09:00 AM - 02:00 PM
                            </b:panel>
                            <b:panel id="panel2" title="Normas del Campo Santo">
                                <p>1. Respetar el silencio.</p>
                                <p>2. No ingresar alimentos.</p>
                            </b:panel>
                        </b:accordion>
                    </b:column>
                </b:row>

                <b:modal id="amodal" title="Registrar Nuevo Difunto" styleClass="modalPseudoClass" closable="false">
                    
                    <h:form id="formRegistro">
                        <b:messages id="msg" showDetail="true" />
                        
                        <b:row>
                            <b:column col-md="12">
                                <b:inputText label="Nombre Completo" value="#{difuntoBean.nuevoDifunto.nombre}" required="true" placeholder="Ej: Juan Pérez"/>
                            </b:column>
                        </b:row>
                        
                        <b:row>
                            <b:column col-md="6">
                                <b:selectOneMenu label="Ubicación (Espacio)" value="#{difuntoBean.espacioSeleccionadoId}" required="true">
                                    <f:selectItem itemLabel="-- Seleccione --" itemValue="" />
                                    <f:selectItems value="#{difuntoBean.listaEspaciosDisponibles}" 
                                                   var="e" itemLabel="#{e.codigo} (#{e.tipo})" itemValue="#{e.id}" />
                                </b:selectOneMenu>
                            </b:column>
                            <b:column col-md="6">
                                <b:inputText label="Hora (HH:mm)" value="#{difuntoBean.horaEntierro}" placeholder="Ej: 15:30">
                                     <f:convertDateTime type="localTime" pattern="HH:mm"/>
                                </b:inputText>
                            </b:column>
                        </b:row>

                        <b:row>
                            <b:column col-md="6">
                                <b:dateTimePicker label="Nacimiento" value="#{difuntoBean.fechaNac}" format="YYYY-MM-DD" required="true">
                                    <f:convertDateTime type="localDate" pattern="yyyy-MM-dd"/>
                                </b:dateTimePicker>
                            </b:column>
                            <b:column col-md="6">
                                <b:dateTimePicker label="Defunción" value="#{difuntoBean.fechaDef}" format="YYYY-MM-DD" required="true">
                                    <f:convertDateTime type="localDate" pattern="yyyy-MM-dd"/>
                                </b:dateTimePicker>
                            </b:column>
                        </b:row>

                        <div style="text-align: right; margin-top: 20px; border-top: 1px solid #e5e5e5; padding-top: 15px;">
                            <b:button value="Cancelar" dismiss="modal" look="default" />
                            <b:commandButton value="Guardar" look="primary" icon="save" style="margin-left: 10px;"
                                             action="#{difuntoBean.agregarDifunto()}" 
                                             update="@form :tablaDifuntos :formRegistro:msg"
                                             oncomplete="if(!validationFailed) { $('.modalPseudoClass').modal('hide'); }"/>
                        </div>
                    </h:form> 
                </b:modal>

            </ui:define>
        </ui:composition>
    </body>
</html>